(function(e){function n(n){for(var a,r,s=n[0],i=n[1],l=n[2],u=0,h=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(c,r)&&c[r]&&h.push(c[r][0]),c[r]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);d&&d(n);while(h.length)h.shift()();return o.push.apply(o,l||[]),t()}function t(){for(var e,n=0;n<o.length;n++){for(var t=o[n],a=!0,r=1;r<t.length;r++){var s=t[r];0!==c[s]&&(a=!1)}a&&(o.splice(n--,1),e=i(i.s=t[0]))}return e}var a={},r={app:0},c={app:0},o=[];function s(e){return i.p+"js/"+({}[e]||e)+"."+{"chunk-7274e382":"34f948d5","chunk-0fdde6d7":"5d090222","chunk-595eea13":"aa740429","chunk-493279aa":"cfdbf0e6"}[e]+".js"}function i(n){if(a[n])return a[n].exports;var t=a[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.e=function(e){var n=[],t={"chunk-7274e382":1,"chunk-0fdde6d7":1,"chunk-595eea13":1,"chunk-493279aa":1};r[e]?n.push(r[e]):0!==r[e]&&t[e]&&n.push(r[e]=new Promise((function(n,t){for(var a="css/"+({}[e]||e)+"."+{"chunk-7274e382":"459d218b","chunk-0fdde6d7":"9e084c19","chunk-595eea13":"ddb9f946","chunk-493279aa":"9d21c0d7"}[e]+".css",c=i.p+a,o=document.getElementsByTagName("link"),s=0;s<o.length;s++){var l=o[s],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===a||u===c))return n()}var h=document.getElementsByTagName("style");for(s=0;s<h.length;s++){l=h[s],u=l.getAttribute("data-href");if(u===a||u===c)return n()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=n,d.onerror=function(n){var a=n&&n.target&&n.target.src||c,o=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=a,delete r[e],d.parentNode.removeChild(d),t(o)},d.href=c;var f=document.getElementsByTagName("head")[0];f.appendChild(d)})).then((function(){r[e]=0})));var a=c[e];if(0!==a)if(a)n.push(a[2]);else{var o=new Promise((function(n,t){a=c[e]=[n,t]}));n.push(a[2]=o);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,i.nc&&u.setAttribute("nonce",i.nc),u.src=s(e);var h=new Error;l=function(n){u.onerror=u.onload=null,clearTimeout(d);var t=c[e];if(0!==t){if(t){var a=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;h.message="Loading chunk "+e+" failed.\n("+a+": "+r+")",h.name="ChunkLoadError",h.type=a,h.request=r,t[1](h)}c[e]=void 0}};var d=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(n)},i.m=e,i.c=a,i.d=function(e,n,t){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,n){if(1&n&&(e=i(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)i.d(t,a,function(n){return e[n]}.bind(null,a));return t},i.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="",i.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=n,l=l.slice();for(var h=0;h<l.length;h++)n(l[h]);var d=u;o.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"56d7":function(e,n,t){"use strict";t.r(n);t("e260"),t("e6cf"),t("cca6"),t("a79d");var a=t("2b0e"),r=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("v-app",[t("v-app-bar",{attrs:{app:"",dense:"",dark:""}}),t("v-main",[t("v-dialog",{attrs:{persistent:"","max-width":"320"},model:{value:e.shouldDisplayNickPrompt,callback:function(n){e.shouldDisplayNickPrompt=n},expression:"shouldDisplayNickPrompt"}},[t("v-card",[t("v-card-title",{staticClass:"headline"},[e._v(" Tell us your nick name ðŸ˜Ž ")]),t("v-card-text",[e._v("As a super simple way to see who wrote a message your nick name or handle will be prepended to your messages.")]),t("v-card-text",[t("v-text-field",{attrs:{label:"Enter your handle",hint:"This will be added to your messages",maxlength:"20",dark:"",outlined:"","full-width":"","append-icon":"mdi-face-agent"},on:{keydown:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.agentHandleEntered(n)},"click:append":e.agentHandleEntered},model:{value:e.internalAgentHandle,callback:function(n){e.internalAgentHandle=n},expression:"internalAgentHandle"}})],1),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:e.agentHandleEntered}},[e._v(" Let's Go ")])],1)],1)],1),t("v-dialog",{attrs:{persistent:"","max-width":"320"},model:{value:e.shouldDisplayHoloConnecting,callback:function(n){e.shouldDisplayHoloConnecting=n},expression:"shouldDisplayHoloConnecting"}},[t("v-card",[t("v-card-title",{staticClass:"headline"},[e._v(" Connecting to HoloPort ")]),t("v-card-text",[e._v(e._s(e.holoConnectionMessage))])],1)],1),t("v-dialog",{attrs:{persistent:"","max-width":"460"},model:{value:e.error.shouldShow,callback:function(n){e.$set(e.error,"shouldShow",n)},expression:"error.shouldShow"}},[t("v-card",[t("v-card-title",{staticClass:"headline"},[e._v(" Hm... Something doesn't look right. ")]),t("v-card-text",[e._v(e._s(e.error.message))]),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:e.clearErrorMessage}},[e._v(" Ok ")])],1)],1)],1),t("v-dialog",{attrs:{persistent:"","max-width":"460"},model:{value:e.shouldDisplayDisconnected,callback:function(n){e.shouldDisplayDisconnected=n},expression:"shouldDisplayDisconnected"}},[t("v-card",[t("v-card-title",{staticClass:"headline"},[e._v(" Establishing connection.. ")]),t("v-card-text",[e._v(" "+e._s(0===e.reconnectingIn?"Connecting...":"Retrying in "+e.reconnectingIn+" seconds..."))]),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:e.retryNow}},[e._v(" Retry Now ")])],1)],1)],1),t("v-responsive",{attrs:{height:"100%"}},[t("transition",{attrs:{name:"fade"}},[t("router-view",{attrs:{id:"router"}})],1)],1)],1)],1)},c=[],o=t("5530"),s=t("2f62");function i(){return!0}function l(){return!1}var u={name:"App",components:{},data:function(){return{internalAgentHandle:"",dialog:!1}},methods:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(s["b"])("elementalChat",["diplayErrorMessage","setChannelPolling"])),Object(s["b"])(["setAgentHandle","skipBackoff"])),{},{agentHandleEntered:function(){""!==this.internalAgentHandle&&(this.setAgentHandle(this.internalAgentHandle),this.dialog=!1)},clearErrorMessage:function(){this.diplayErrorMessage({message:"",shouldShow:!1})},retryNow:function(){this.skipBackoff()}}),computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(s["c"])("elementalChat",["error"])),Object(s["c"])(["agentHandle","needsHandle","conductorDisconnected","firstConnect","reconnectingIn","isHoloSignedIn","isChaperoneDisconnected"])),{},{shouldDisplayNickPrompt:function(){return this.needsHandle&&!this.error.message&&!this.conductorDisconnected&&!this.shouldDisplayHoloConnecting},shouldDisplayDisconnected:function(){return this.conductorDisconnected&&!this.firstConnect},shouldDisplayHoloConnecting:function(){return i()&&(!this.isHoloSignedIn||this.isChaperoneDisconnected)},holoConnectionMessage:function(){return this.isChaperoneDisconnected?"Can't find HoloPort. Please check your internet connection and refresh this page.":"Connecting to HoloPort..."}}),created:function(){this.$store.dispatch("initialiseStore"),this.$vuetify.theme.dark=!0},mounted:function(){this.setChannelPolling()}},h=u,d=(t("bad3"),t("2877")),f=t("6544"),p=t.n(f),g=t("7496"),m=t("40dc"),v=t("8336"),b=t("b0af"),C=t("99d9"),w=t("169a"),y=t("f6c4"),_=t("6b53"),O=t("2fa4"),k=t("8654"),E=Object(d["a"])(h,r,c,!1,null,"54ab73a3",null),S=E.exports;p()(E,{VApp:g["a"],VAppBar:m["a"],VBtn:v["a"],VCard:b["a"],VCardActions:C["a"],VCardText:C["b"],VCardTitle:C["c"],VDialog:w["a"],VMain:y["a"],VResponsive:_["a"],VSpacer:O["a"],VTextField:k["a"]});t("ddb8"),t("d3b7");var x=t("8c4f");a["a"].use(x["a"]);var R=[{path:"/",name:"Public Messages",component:function(){return t.e("chunk-7274e382").then(t.bind(null,"4a94"))}}],I=new x["a"]({mode:"history",base:window.location.pathname,routes:R}),j=I,D=(t("fb6a"),t("96cf"),t("1da1")),A=t("2d36"),H=t("ca06"),P=(t("99af"),t("4de4"),t("7db0"),t("4160"),t("d81d"),t("13d5"),t("b0c0"),t("159b"),t("15fd")),N=t("2909");function T(e,n,t){e("listMessages",{channel:t,chunk:{start:0,end:0},active_chatter:n})}function M(e,n){console.log(Date.now(),e),void 0!==n&&console.log(n)}function V(e){return e.sort((function(e,n){return e.info.name>n.info.name?1:-1})),e}var U=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",n("resetConnectionState",null,{root:!0}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),L=function(e,n,t,a,r){return n.holoClient.zomeCall("chat_dna_alias",t,a,r)},B=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n,t,a,r,c,o){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.conductorDisconnected){e.next=3;break}return M("callZome called when disconnected from conductor"),e.abrupt("return");case 3:return e.prev=3,e.next=6,t.holochainClient.callZome({cap:null,cell_id:t.appInterface.cellId,zome_name:a,fn_name:r,provenance:t.agentKey,payload:c},o);case 6:return s=e.sent,e.abrupt("return",s);case 10:if(e.prev=10,e.t0=e["catch"](3),M("ERROR: callZome threw error",e.t0),"Error: Socket is not open"!=e.t0){e.next=15;break}return e.abrupt("return",U(n));case 15:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(n,t,a,r,c,o){return e.apply(this,arguments)}}(),z=i()?L:B;function F(e,n,t,a,r){var c=!!a.messages.find((function(e){return r.message.uuid===e.message.uuid}));if(!c){var s=Object(N["a"])(a.messages);s.push(r);var i=Object(o["a"])(Object(o["a"])({},a),{},{last_seen:{Message:r.entryHash},messages:s});s.sort((function(e,n){return e.createdAt[0]-n.createdAt[0]})),M("got message",r),M("adding message to the channel ".concat(i.channel.uuid),i),t.channel.channel.uuid==a.channel.uuid?n("setChannel",i):n("setUnseen",a.channel.uuid),M("addMessageToChannel dexie start"),e.hcDb.elementalChat.put(i,a.channel.uuid).then(M("addMessageToChannel dexie done")).catch((function(e){return M(e)}))}}var G=0,W=0,K={namespaced:!0,state:{channels:[],channel:{info:{name:""},channel:{category:"General",uuid:""},messages:[],unseen:!1},stats:{},showStats:!1,statsLoading:!1,error:{shouldShow:!1,message:""}},actions:{updateHandle:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=n.rootState,M("Updating Handle"),t.needsHandle=!0;case 3:case"end":return e.stop()}}),e)})));function n(n){return e.apply(this,arguments)}return n}(),getStats:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n){var t,a,r,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=n.state,a=n.rootState,r=n.dispatch,c=n.commit,M("Getting Stats..."),c("loadStats"),z(r,a,"chat","agent_stats",null,6e4).then(function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n){var r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return M("stats zomeCall done"),M("Peer stats: ",n),r=0,s=0,e.next=6,a.hcDb.elementalChat.get("General").then(function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=void 0===n?0:n.length,t=0;case 2:if(!(t<n.length)){e.next=8;break}return e.next=5,a.hcDb.elementalChat.get(n[t].channel.uuid).then((function(e){void 0!==e&&void 0!==e.messages&&(s+=e.messages.length)}));case 5:t++,e.next=2;break;case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 6:r=r>t.channels?r:t.channels.length,M("Total stats: ",Object(o["a"])({channels:r,messages:s},n)),c("setStats",Object(o["a"])({channels:r,messages:s},n));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){M("stats zomeCall error",e),c("resetStats")}));case 4:case"end":return e.stop()}}),e)})));function n(n){return e.apply(this,arguments)}return n}(),resetStats:function(e){var n=e.commit;n("resetStats")},setChannel:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n,t){var a,r,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=n.commit,r=n.rootState,c=n.dispatch,M("setChannel start"),M("Setting channel payload",t),r.hcDb.elementalChat.get(t.channel.uuid).then((function(e){M("setChannel dexie done"),void 0===e&&(e=t),a("setChannel",e),T(c,!0,t),clearInterval(W),W=setInterval((function(){T(c,!0,t)}),6e4)})).catch((function(e){return M(e)}));case 4:case"end":return e.stop()}}),e)})));function n(n,t){return e.apply(this,arguments)}return n}(),setChannelPolling:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=n.dispatch,clearInterval(G),G=setInterval((function(){t("listChannels",{category:"General"})}),3e5);case 3:case"end":return e.stop()}}),e)})));function n(n){return e.apply(this,arguments)}return n}(),addSignalChannel:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n,t){var a,r,c,s,i,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=n.commit,r=n.state,c=n.rootState,s=n.dispatch,i=t,l=!!r.channels.find((function(e){return e.channel.uuid===i.channel.uuid})),!l){e.next=5;break}return e.abrupt("return");case 5:M("new channel signal received"),M("received channel : ",i),i.last_seen={First:null},a("createChannel",Object(o["a"])(Object(o["a"])({},i),{},{messages:[]})),c.hcDb.elementalChat.put(Object(o["a"])(Object(o["a"])({},i),{},{messages:[]}),i.channel.uuid).then(M("createChannel dexie done")).catch((function(e){return M(e)})),s("setChannel",Object(o["a"])(Object(o["a"])({},i),{},{messages:[]}));case 11:case"end":return e.stop()}}),e)})));function n(n,t){return e.apply(this,arguments)}return n}(),createChannel:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n,t){var a,r,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=n.commit,r=n.rootState,c=n.dispatch,M("createChannel start"),s={name:t.info.name,channel:t.channel},z(c,r,"chat","create_channel",s,6e4).then((function(e){M("createChannel zome done"),e.last_seen={First:null},a("createChannel",Object(o["a"])(Object(o["a"])({},e),{},{messages:[]})),M("created channel : ",e),r.hcDb.elementalChat.put(Object(o["a"])(Object(o["a"])({},e),{},{messages:[]}),e.channel.uuid).then(M("createChannel dexie done")).catch((function(e){return M(e)})),c("setChannel",Object(o["a"])(Object(o["a"])({},e),{},{messages:[]}))})).catch((function(e){return M("createChannel zome error",e)}));case 4:case"end":return e.stop()}}),e)})));function n(n,t){return e.apply(this,arguments)}return n}(),listChannels:function(e,n){var t=e.commit,a=e.rootState,r=e.state,c=e.dispatch;M("listChannels start"),a.hcDb.elementalChat.get(n.category).then((function(e){void 0!==e&&t("setChannels",e)})),M("listChannels zome start"),z(c,a,"chat","list_channels",n,3e4).then(function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(s){var i,l,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(M("listChannels zome done"),s){e.next=5;break}M("listChannels zome returned undefined"),e.next=20;break;case 5:return t("setChannels",s.channels),M("put listChannels dexie start"),e.next=9,a.hcDb.elementalChat.get("General");case 9:if(e.t0=e.sent,e.t0){e.next=12;break}e.t0=[];case 12:i=e.t0,l=[],l=s.channels.filter((function(e){return!i.find((function(n){return n.channel.uuid==e.channel.uuid}))})),u=V(s.channels),a.hcDb.elementalChat.put(u,n.category).then(M("put listChannels dexie done")).catch((function(e){return M(e)})),M("SETTING channels in indexDb : ",s.channels),""===r.channel.info.name&&s.channels.length>0&&c("setChannel",Object(o["a"])(Object(o["a"])({},s.channels[0]),{},{messages:[]})),l.forEach((function(e){return T(c,!1,e)}));case 20:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){return M("listChannels zome error",e)}))},addSignalMessageToChannel:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n,t){var a,r,c,o,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=n.commit,r=n.rootState,c=n.state,o=t.channel,s=Object(P["a"])(t,["channel"]),M("new message signal received"),i=c.channels.find((function(e){return e.channel.uuid===o.channel.uuid})),i){e.next=6;break}return e.abrupt("return");case 6:r.hcDb.elementalChat.get(i.channel.uuid).then((function(e){M("received signal message : ",s),F(r,a,c,e,s.message)})).catch((function(e){return M(e)}));case 7:case"end":return e.stop()}}),e)})));function n(n,t){return e.apply(this,arguments)}return n}(),addMessageToChannel:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n,t){var a,r,c,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=n.commit,r=n.rootState,c=n.state,s=n.dispatch,M("addMessageToChannel start"),i={last_seen:t.channel.last_seen,channel:t.channel.channel,message:Object(o["a"])(Object(o["a"])({},t.message),{},{content:"".concat(r.agentHandle.toUpperCase(),":\n      ").concat(t.message.content)}),chunk:0},z(s,r,"chat","create_message",i,6e4).then((function(e){M("addMessageToChannel zome done"),F(r,a,c,c.channel,e);var n={messageData:e,channelData:t.channel};s("signalMessageSent",n)})).catch((function(e){return M("addMessageToChannel zome error:",e)}));case 4:case"end":return e.stop()}}),e)})));function n(n,t){return e.apply(this,arguments)}return n}(),signalMessageSent:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n,t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=n.rootState,M("signalMessageSent start"),a.holochainClient.callZome({cap:null,cell_id:a.appInterface.cellId,zome_name:"chat",fn_name:"signal_chatters",provenance:a.agentKey,payload:t},6e4).then((function(e){M("signalMessageSent zome done",e)})).catch((function(e){return M("signalMessageSent zome error:",e)}));case 3:case"end":return e.stop()}}),e)})));function n(n,t){return e.apply(this,arguments)}return n}(),listMessages:function(e,n){return Object(D["a"])(regeneratorRuntime.mark((function t(){var a,r,c,s,i,l,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.commit,r=e.state,c=e.rootState,s=e.dispatch,M("listMessages start"),M("listMessages payload",n),i={channel:n.channel.channel,chunk:n.chunk,active_chatter:n.active_chatter},l=n.channel.channel.uuid,t.next=7,c.hcDb.elementalChat.get(l);case 7:u=t.sent,z(s,c,"chat","list_messages",i,3e4).then((function(e){M("listMessages zome done"),n.channel.last_seen={First:null},e.messages.length>0&&(n.channel.last_seen={Message:e.messages[e.messages.length-1].entryHash});var t=[],s=[];void 0!==u&&void 0!==u.messages&&(s=e.messages.filter((function(e){return!u.messages.find((function(n){return n.message.uuid==e.message.uuid}))})),t=u.messages.filter((function(n){return!e.messages.find((function(e){return e.message.uuid==n.message.uuid}))})));var i=[].concat(Object(N["a"])(e.messages),Object(N["a"])(t));i.sort((function(e,n){return e.createdAt[0]-n.createdAt[0]}));var h=Object(o["a"])(Object(o["a"])({},n.channel),{},{messages:i});a("setChannelMessages",h),M("put listMessages dexie start"),r.channel.channel.uuid!==l&&e.messages.length>0&&(void 0===u||void 0===u.messages||s.length>0)&&a("setUnseen",l),c.hcDb.elementalChat.put(h,l).then(M("put listMessages dexie done")).catch((function(e){return M(e)}))})).catch((function(e){return M("listMessages zome done",e)}));case 9:case"end":return t.stop()}}),t)})))()},diplayErrorMessage:function(e,n){var t=e.commit;t("setError",n)},rehydrateChannels:function(e){return Object(D["a"])(regeneratorRuntime.mark((function n(){var t,a,r,c,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=e.dispatch,a=e.commit,r=e.rootState,t("listChannels",{category:"General"}),c=[],n.next=5,r.hcDb.elementalChat.each((function(e){0!==e.length&&(e.length>0?e.map((function(e){return c.push(e)})):c.push(e))}));case 5:o=c.reduce((function(e,n){var t=e.find((function(e){return e.channel.uuid===n.channel.uuid}));return t?e:e.concat([n])}),[]),o.length>0&&a("setChannels",o);case 7:case"end":return n.stop()}}),n)})))()},resetState:function(e){var n=e.commit;n("resetState")},refreshChatter:function(e){var n=e.dispatch,t=e.rootState;M("refreshChatter start"),z(n,t,"chat","refresh_chatter",null,3e4).then((function(){M("refreshChatter zome done")})).catch((function(e){return M("refreshChatter zome error",e)}))}},mutations:{setChannel:function(e,n){M("setChannel payload",n),e.channel=Object(o["a"])({},n),e.channels.map((function(e){e.channel.uuid===n.channel.uuid&&(M("clearing unseen for ",e),e.unseen=!1)}))},setChannels:function(e,n){n.map((function(n){var t=e.channels.find((function(e){return e.channel.uuid===n.channel.uuid}));return t&&(n.unseen=t.unseen),n})),e.channels=V(n)},setChannelMessages:function(e,n){console.log("setting payload",n),e.channels=e.channels.map((function(e){return e.channel.uuid!==n.channel.uuid?e:Object(o["a"])(Object(o["a"])({},e),n)})),e.channel.channel.uuid===n.channel.uuid&&(e.channel=Object(o["a"])({},n))},createChannel:function(e,n){var t=e.channels;t.push(n),e.channels=V(t)},setError:function(e,n){e.error=n},setUnseen:function(e,n){e.channels.map((function(e){e.channel.uuid===n&&(M("setting unseen for ",e),e.unseen=!0)}))},resetState:function(e){e.channels=[],e.channel={info:{name:""},channel:{category:"General",uuid:""},messages:[]}},loadStats:function(e){e.showStats=!0,e.statsLoading=!0},setStats:function(e,n){e.showStats=!0,e.statsLoading=!1,e.stats.agents=n.agents,e.stats.active=n.active,e.stats.channels=n.channels,e.stats.messages=n.messages},resetStats:function(e){e.showStats=void 0,e.statsLoading=void 0}}},$=function(e){e.subscribe((function(e,n){})),e.subscribeAction({before:function(e,n){},after:function(e,n){}})},X=(t("5cc6"),t("9a8c"),t("a975"),t("735e"),t("c1ac"),t("d139"),t("3a7b"),t("d5d6"),t("82f8"),t("e91f"),t("60bd"),t("5f96"),t("3280"),t("3fcc"),t("ca91"),t("25a1"),t("cd26"),t("3c5d"),t("2954"),t("649e"),t("219c"),t("170b"),t("b39a"),t("72f7"),function(e){for(var n="",t=new Uint8Array(e),a=t.byteLength,r=0;r<a;r++)n+=String.fromCharCode(t[r]);return window.btoa(n)});function Z(e){return{signIn:function(){return e.signIn.apply(e,arguments)},signOut:function(){return e.signOut.apply(e,arguments)},appInfo:function(){return e.appInfo.apply(e,arguments)},ready:function(){return e.ready.apply(e,arguments)},zomeCall:function(){return e.zomeCall.apply(e,arguments)}}}a["a"].use(s["a"]);var J=15,q="0.0.1-alpha23",Q="alpha17",Y="0002",ee="8888"===Object({VUE_APP_CHAPERONE_SERVER_URL:"https://chaperone.holohost.dev/",VUE_APP_CONTEXT:"holo-host",VUE_APP_UI_VERSION:"0.0.1-alpha23",NODE_ENV:"production",BASE_URL:""}).VUE_APP_WEB_CLIENT_PORT?"elemental-chat-1":"9999"===Object({VUE_APP_CHAPERONE_SERVER_URL:"https://chaperone.holohost.dev/",VUE_APP_CONTEXT:"holo-host",VUE_APP_UI_VERSION:"0.0.1-alpha23",NODE_ENV:"production",BASE_URL:""}).VUE_APP_WEB_CLIENT_PORT?"elemental-chat-2":"elemental-chat:".concat(Q).concat(Y?":"+Y:""),ne=Object({VUE_APP_CHAPERONE_SERVER_URL:"https://chaperone.holohost.dev/",VUE_APP_CONTEXT:"holo-host",VUE_APP_UI_VERSION:"0.0.1-alpha23",NODE_ENV:"production",BASE_URL:""}).VUE_APP_WEB_CLIENT_PORT||8888,te=i()||l()?"wss://".concat(window.location.hostname,"/api/v1/ws/"):"ws://localhost:".concat(ne);console.log("process.env.NODE_ENV === 'development' : ",!1),console.log("process.env.VUE_APP_CONTEXT : ","holo-host"),console.log("INSTALLED_APP_ID : ",ee),console.log("WEB_CLIENT_URI : ",te),function(){function e(){var e=this;return new Promise((function(n){var t=new FileReader;t.onload=function(){n(t.result)},t.readAsArrayBuffer(e)}))}"File"in self&&(File.prototype.arrayBuffer=File.prototype.arrayBuffer||e),Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||e}();var ae,re=[],ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(n){return setTimeout(n,e)}))},oe=function(e,n){console.log("Incoming signal");var t=e.data.payload,a=t.signal_name,r=t.signal_payload;switch(a){case"Message":console.log("INCOMING SIGNAL > NEW MESSAGE"),console.log("payload"+JSON.stringify(r)),ae||(ae=setInterval(Object(D["a"])(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=re.slice(),re=[],a=0;case 3:if(!(a<t.length)){e.next=11;break}return r=t[a],n("elementalChat/addSignalMessageToChannel",{channel:r.channelData,message:r.messageData}),e.next=8,ce(100);case 8:a++,e.next=3;break;case 11:case"end":return e.stop()}}),e)}))),500)),re.push(r);break;case"Channel":console.log("INCOMING SIGNAL > NEW CHANNEL");break;default:throw new Error("Received an unsupported signal by name : ",name)}},se=function(e,n,t,a){var r=e.cell_data[0][0],c=X(r[0]);console.log("cellId : ",c,X(r[1])),a.hcDb.agent.get("dnaHash").then((function(e){null===e||void 0===e||""===e||c!=e&&(n("contentReset"),t("elementalChat/resetState")),a.hcDb.agent.put(c,"dnaHash")}))},ie=!1,le=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(n,t,a){var r,c,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!ie){e.next=2;break}return e.abrupt("return");case 2:return ie=!0,a.holoClient?r=a.holoClient:(c=new H["Connection"]("https://chaperone.holohost.dev/"),r=Z(c),n("setHoloClient",r)),e.prev=4,e.next=7,r.ready();case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e["catch"](4),n("setIsChaperoneDisconnected",!0),e.abrupt("return");case 13:if(a.isHoloSignedIn){e.next=24;break}return e.prev=14,e.next=17,r.signIn();case 17:n("setIsHoloSignedIn",!0),e.next=24;break;case 20:return e.prev=20,e.t1=e["catch"](14),n("setIsChaperoneDisconnected",!0),e.abrupt("return");case 24:return e.next=26,r.appInfo();case 26:o=e.sent,se(o,n,t,a),ie=!1;case 29:case"end":return e.stop()}}),e,null,[[4,9],[14,20]])})));return function(n,t,a){return e.apply(this,arguments)}}(),ue=function(e,n,t){A["AppWebsocket"].connect(te,(function(e){return oe(e,n)})).then((function(a){a.appInfo({installed_app_id:ee}).then((function(r){se(r,e,n,t);var c=r.cell_data[0][0],o=c[1];console.log("agent key : ",X(o)),e("setAgentKey",o),e("setAppInterface",{port:ne,appId:ee,cellId:c,appVersion:q}),e("setHolochainClient",a),n("elementalChat/refreshChatter")})),a.onclose=function(n){e("resetConnectionState"),console.log("Socket is closed. Reconnect will be attempted in ".concat(J," seconds."),n.reason),e("setReconnecting",J)}})).catch((function(n){console.log("Connection Error ",n),e("setReconnecting",J)}))},he=i()?le:ue;function de(e){return-1===e.reconnectingIn}function fe(e){return e.reconnectingIn>0}var pe=new s["a"].Store({state:{holochainClient:null,holoClient:null,isHoloSignedIn:!1,isChaperoneDisconnected:!1,conductorDisconnected:!0,reconnectingIn:0,needsHandle:!1,agentHandle:"",appInterface:null,firstConnect:!1},mutations:{setAgentKey:function(e,n){e.agentKey=n},needsHandle:function(e,n){e.needsHandle=n},setAgentHandle:function(e,n){e.agentHandle=n,e.needsHandle=!1},setAppInterface:function(e,n){e.appInterface=n},setReconnecting:function(e,n){e.firstConnect=!1,e.reconnectingIn=n},setHolochainClient:function(e,n){e.holochainClient=n,e.conductorDisconnected=!1,e.reconnectingIn=-1,e.firstConnect=!1},setHoloClient:function(e,n){e.holoClient=n,e.conductorDisconnected=!1,e.reconnectingIn=-1,e.firstConnect=!1},setIsHoloSignedIn:function(e,n){e.isHoloSignedIn=n},setIsChaperoneDisconnected:function(e,n){e.isChaperoneDisconnected=n},contentReset:function(e){console.log("CONTENT RESET (DNA CHANGED)"),e.hcDb.agent.put("","agentHandle"),e.hcDb.elementalChat.clear(),e.needsHandle=!0,e.agentHandle=""},resetConnectionState:function(e){console.log("RESETTING CONNECTION STATE"),e.holochainClient=null,e.holoClient=null,e.conductorDisconnected=!0,e.reconnectingIn=J,e.appInterface=null}},actions:{initialiseStore:function(e){var n=e.commit,t=e.state,a=e.dispatch;t.hcDb.version(1).stores({agent:"",elementalChat:""}),a("initialiseAgent"),setInterval((function(){de(t)&&a("elementalChat/refreshChatter")}),72e5),setInterval((function(){de(t)||(fe(t)?n("setReconnecting",t.reconnectingIn-1):a("initialiseAgent"))}),1e3)},initialiseAgent:function(e){var n=e.commit,t=e.dispatch,a=e.state;a.hcDb.agent.get("agentHandle").then((function(e){null===e||void 0===e||""===e?n("needsHandle",!0):n("setAgentHandle",e)})),he(n,t,a)},setAgentHandle:function(e,n){var t=e.commit,a=e.state;t("setAgentHandle",n),a.hcDb.agent.put(n,"agentHandle")},skipBackoff:function(e){var n=e.commit;n("setReconnecting",0)},resetConnectionState:function(e){var n=e.commit;n("resetConnectionState")},holoLogout:function(e){return Object(D["a"])(regeneratorRuntime.mark((function n(){var t,a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t=e.rootState,a=e.commit,r=e.dispatch,!t.holoClient){n.next=4;break}return n.next=4,t.holoClient.signOut();case 4:a("setIsHoloSignedIn",!1),a("contentReset"),r("elementalChat/resetState"),r("initialiseAgent");case 8:case"end":return n.stop()}}),n)})))()}},modules:{elementalChat:K},plugins:[$]}),ge=t("f309");a["a"].use(ge["a"]);var me=new ge["a"]({theme:{dark:!0,themes:{dark:{primary:"#5c007a",accent:"#424242",secondary:"#9c27b0",success:"#4CAF50",info:"#2196F3",warning:"#FB8C00",error:"#FF5252"},light:{primary:"#1976D2",accent:"#e91e63",secondary:"#30b1dc",success:"#4CAF50",info:"#2196F3",warning:"#FB8C00",error:"#FF5252"}}}}),ve=t("4dec"),be=new ve["a"]("holochain"),Ce=pe;Ce.state.hcDb=be,a["a"].config.productionTip=!1,window.App=new a["a"]({router:j,store:Ce,vuetify:me,render:function(e){return e(S)}}).$mount("#app")},"9b2e":function(e,n,t){},bad3:function(e,n,t){"use strict";t("9b2e")},ddb8:function(e,n){}});
//# sourceMappingURL=app.d47abd1a.js.map